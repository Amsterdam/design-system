/**
 * @license EUPL-1.2+
 * Copyright Gemeente Amsterdam
 */

@use "../../common/breakpoint" as *;
@use "../../common/hyphenation" as *;
@use "../../common/text-rendering" as *;

@mixin reset-ol {
  list-style: none;
  margin-block: 0;
  padding-inline-start: 0;
}

.ams-progress-list,
.ams-progress-list__sub-steps {
  @include hyphenation;
  @include text-rendering;
  @include reset-ol;
}

.ams-progress-list__sub-steps {
  display: flex;
  flex-direction: column;
  gap: var(--ams-progress-list-step-sub-steps-gap);
}

// Step and sub-step

.ams-progress-list__step,
.ams-progress-list__sub-step {
  display: flex;
}

.ams-progress-list__sub-step:first-child {
  padding-block-start: var(--ams-progress-list-step-sub-steps-sub-step-padding-block-start);
}

.ams-progress-list__sub-step:last-child {
  padding-block-end: var(--ams-progress-list-step-sub-steps-sub-step-padding-block-end);
}

// Indicator

.ams-progress-list__indicator {
  display: grid;
  flex: none;
  padding-inline: var(--ams-progress-list-step-indicator-padding-inline);
  place-items: start center;

  @media screen and (min-width: $ams-breakpoint-medium) {
    padding-inline: var(--ams-progress-list-step-indicator-medium-padding-inline);
  }
}

.ams-progress-list-sub-step__indicator {
  background-color: var(--ams-progress-list-step-sub-steps-sub-step-indicator-background-color);
  display: grid;
  flex: none;
  padding-inline-end: var(--ams-progress-list-step-sub-steps-sub-step-indicator-padding-inline-end);
  place-items: start center;

  /*
  * round() eliminates sub-pixel rendering issues, caused by the sizing of the marker.
  * In unsupported browsers it will still be centered, but the circle can be distorted.
  */
  // stylelint-disable plugin/use-baseline
  .ams-progress-list--heading-2 & {
    margin-inline-start: var(--ams-progress-list-heading-2-step-sub-steps-sub-step-indicator-margin-inline-start);

    @supports (block-size: round(down, 1px, 1px)) {
      margin-inline-start: round(
        down,
        var(--ams-progress-list-heading-2-step-sub-steps-sub-step-indicator-margin-inline-start),
        2px
      );
    }
  }

  .ams-progress-list--heading-3 & {
    margin-inline-start: var(--ams-progress-list-heading-3-step-sub-steps-sub-step-indicator-margin-inline-start);

    @supports (block-size: round(down, 1px, 1px)) {
      margin-inline-start: round(
        down,
        var(--ams-progress-list-heading-3-step-sub-steps-sub-step-indicator-margin-inline-start),
        2px
      );
    }
  }

  .ams-progress-list--heading-4 & {
    margin-inline-start: var(--ams-progress-list-heading-4-step-sub-steps-sub-step-indicator-margin-inline-start);

    @supports (block-size: round(down, 1px, 1px)) {
      margin-inline-start: round(
        down,
        var(--ams-progress-list-heading-4-step-sub-steps-sub-step-indicator-margin-inline-start),
        2px
      );
    }
  }

  @media screen and (min-width: $ams-breakpoint-medium) {
    padding-inline-end: var(--ams-progress-list-step-sub-steps-sub-step-indicator-medium-padding-inline);

    .ams-progress-list--heading-2 & {
      margin-inline-start: var(
        --ams-progress-list-heading-2-step-sub-steps-sub-step-indicator-medium-margin-inline-start
      );

      @supports (block-size: round(down, 1px, 1px)) {
        margin-inline-start: round(
          down,
          var(--ams-progress-list-heading-2-step-sub-steps-sub-step-indicator-medium-margin-inline-start),
          2px
        );
      }
    }

    .ams-progress-list--heading-3 & {
      margin-inline-start: var(
        --ams-progress-list-heading-3-step-sub-steps-sub-step-indicator-medium-margin-inline-start
      );

      @supports (block-size: round(down, 1px, 1px)) {
        margin-inline-start: round(
          down,
          var(--ams-progress-list-heading-3-step-sub-steps-sub-step-indicator-medium-margin-inline-start),
          2px
        );
      }
    }

    .ams-progress-list--heading-4 & {
      margin-inline-start: var(
        --ams-progress-list-heading-4-step-sub-steps-sub-step-indicator-medium-margin-inline-start
      );

      @supports (block-size: round(down, 1px, 1px)) {
        margin-inline-start: round(
          down,
          var(--ams-progress-list-heading-4-step-sub-steps-sub-step-indicator-medium-margin-inline-start),
          2px
        );
      }
    }
  }
  // stylelint-enable plugin/use-baseline
}

// Marker

.ams-progress-list__marker {
  display: flex;
  grid-area: 1 / 1; // Overlaps the marker and connector.
  place-items: center;
  z-index: 1;

  .ams-progress-list--heading-2 & {
    block-size: var(--ams-progress-list-heading-2-step-marker-block-size);
  }

  .ams-progress-list--heading-3 & {
    block-size: var(--ams-progress-list-heading-3-step-marker-block-size);
  }

  .ams-progress-list--heading-4 & {
    block-size: var(--ams-progress-list-heading-4-step-marker-block-size);
  }
}

.ams-progress-list__marker-shape {
  aspect-ratio: 1;
  background-color: var(--ams-progress-list-step-marker-background-color);
  border-color: var(--ams-progress-list-step-marker-border-color);
  border-radius: 50%;
  border-style: var(--ams-progress-list-step-marker-border-style);
  border-width: var(--ams-progress-list-step-marker-border-width);
  box-sizing: border-box;
  display: flex;
  justify-content: center;

  /*
  * round() eliminates sub-pixel rendering issues that distort circular markers.
  * Minor degradation in unsupported browsers is visually unnoticeable.
  */
  // stylelint-disable plugin/use-baseline
  .ams-progress-list--heading-2 & {
    block-size: var(--ams-progress-list-heading-2-step-shape-block-size);
    inline-size: var(--ams-progress-list-heading-2-step-shape-inline-size);

    @supports (block-size: round(down, 1px, 1px)) {
      block-size: round(down, var(--ams-progress-list-heading-2-step-shape-block-size), 2px);
      inline-size: round(down, var(--ams-progress-list-heading-2-step-shape-inline-size), 2px);
    }
  }

  .ams-progress-list--heading-3 & {
    block-size: var(--ams-progress-list-heading-3-step-shape-block-size);
    inline-size: var(--ams-progress-list-heading-3-step-shape-inline-size);

    @supports (block-size: round(down, 1px, 1px)) {
      block-size: round(down, var(--ams-progress-list-heading-3-step-shape-block-size), 2px);
      inline-size: round(down, var(--ams-progress-list-heading-3-step-shape-inline-size), 2px);
    }
  }

  .ams-progress-list--heading-4 & {
    block-size: var(--ams-progress-list-heading-4-step-shape-block-size);
    inline-size: var(--ams-progress-list-heading-4-step-shape-inline-size);

    @supports (block-size: round(down, 1px, 1px)) {
      block-size: round(down, var(--ams-progress-list-heading-4-step-shape-block-size), 2px);
      inline-size: round(down, var(--ams-progress-list-heading-4-step-shape-inline-size), 2px);
    }
  }
  // stylelint-enable plugin/use-baseline

  .ams-progress-list__step--completed & {
    background-color: var(--ams-progress-list-step-completed-marker-background-color);
    border: var(--ams-progress-list-step-completed-marker-border);
  }

  .ams-progress-list__step[aria-current] & {
    background-color: var(--ams-progress-list-step-current-marker-background-color);
    border-color: var(--ams-progress-list-step-current-marker-border-color);
  }
}

.ams-progress-list__marker-icon,
.ams-progress-list-sub-step__marker-icon {
  align-self: center;
  inline-size: 100%;
}

.ams-progress-list-sub-step__marker {
  background-color: var(--ams-progress-list-step-sub-steps-sub-step-marker-background-color);
  block-size: var(--ams-progress-list-step-sub-steps-sub-step-marker-block-size);
  grid-area: 1/1;
  place-content: center;
  z-index: 2;

  // stylelint-disable plugin/use-baseline
  .ams-progress-list--heading-2 & {
    inline-size: var(--ams-progress-list-heading-2-step-sub-steps-sub-step-marker-inline-size);

    @supports (block-size: round(down, 1px, 1px)) {
      inline-size: round(down, var(--ams-progress-list-heading-2-step-sub-steps-sub-step-marker-inline-size), 2px);
    }
  }

  .ams-progress-list--heading-3 & {
    inline-size: var(--ams-progress-list-heading-3-step-sub-steps-sub-step-marker-inline-size);

    @supports (block-size: round(down, 1px, 1px)) {
      inline-size: round(down, var(--ams-progress-list-heading-3-step-sub-steps-sub-step-marker-inline-size), 2px);
    }
  }

  .ams-progress-list--heading-4 & {
    inline-size: var(--ams-progress-list-heading-4-step-sub-steps-sub-step-marker-inline-size);

    @supports (block-size: round(down, 1px, 1px)) {
      inline-size: round(down, var(--ams-progress-list-heading-4-step-sub-steps-sub-step-marker-inline-size), 2px);
    }
  }
  // stylelint-enable plugin/use-baseline
}

.ams-progress-list-sub-step__marker-shape {
  background-color: var(--ams-progress-list-step-sub-steps-sub-step-marker-background-color);
  border-color: var(--ams-progress-list-step-sub-steps-sub-step-marker-border-color);
  border-style: var(--ams-progress-list-step-sub-steps-sub-step-marker-border-style);
  border-width: var(--ams-progress-list-step-sub-steps-sub-step-marker-border-width);
  box-sizing: border-box;
  display: flex;
  inline-size: 100%;
  justify-content: center;
  margin-inline-start: var(--ams-progress-list-step-sub-steps-sub-step-margin-inline-start);
  position: relative;
  z-index: 2;

  .ams-progress-list__sub-step--current & {
    block-size: inherit;
    border: none;
  }

  .ams-progress-list__sub-step--completed & {
    border-color: var(--ams-progress-list-step-sub-steps-sub-step-completed-marker-border-color);
  }
}

// Connector

.ams-progress-list__connector {
  align-self: stretch;
  block-size: 100%;
  border-inline-color: var(--ams-progress-list-step-connector-border-inline-color);
  border-inline-style: var(--ams-progress-list-step-connector-border-inline-style);
  border-inline-width: var(--ams-progress-list-step-connector-border-inline-width);
  grid-area: 1 / 1; // Overlaps the marker and connector.

  .ams-progress-list--heading-2 & {
    margin-block-start: var(--ams-progress-list-heading-2-step-marker-margin-block-start);
  }

  .ams-progress-list--heading-3 & {
    margin-block-start: var(--ams-progress-list-heading-3-step-marker-margin-block-start);
  }

  .ams-progress-list--heading-4 & {
    margin-block-start: var(--ams-progress-list-heading-4-step-marker-margin-block-start);
  }

  .ams-progress-list__step--completed & {
    background-color: var(--ams-progress-list-step-completed-connector-background-color);
    border-inline-color: var(--ams-progress-list-step-completed-connector-border-inline-color);
    border-inline-style: var(--ams-progress-list-step-completed-connector-border-inline-style);
  }

  .ams-progress-list__step[aria-current] & {
    border-inline-color: var(--ams-progress-list-step-current-connector-border-inline-color);
  }

  .ams-progress-list > .ams-progress-list__step:last-child:not(.ams-progress-list__step--has-sub-steps) & {
    display: none;
  }

  @supports selector(:has(*)) {
    .ams-progress-list > .ams-progress-list__step:last-child:not(:has(.ams-progress-list__sub-steps)) & {
      display: none;
    }
  }
}

.ams-progress-list-sub-step__connector {
  align-self: stretch;
  background-color: var(--ams-progress-list-step-sub-steps-sub-step-connector-background-color);
  border-inline-color: var(--ams-progress-list-step-sub-steps-sub-step-connector-border-inline-color);
  border-inline-style: var(--ams-progress-list-step-sub-steps-sub-step-connector-border-inline-style);
  border-inline-width: var(--ams-progress-list-step-sub-steps-sub-step-connector-border-inline-width);
  grid-area: 1 / 1; // Overlaps the marker and connector.

  .ams-progress-list__sub-step--current & {
    border-inline-color: var(--ams-progress-list-step-sub-steps-sub-step-current-connector-border-inline-color);
  }

  .ams-progress-list__sub-step--completed & {
    background-color: var(--ams-progress-list-step-sub-steps-sub-step-completed-connector-background-color);
    border-inline-color: var(--ams-progress-list-step-sub-steps-sub-step-completed-connector-border-inline-color);
    border-inline-style: var(--ams-progress-list-step-sub-steps-sub-step-completed-connector-border-inline-style);
  }

  .ams-progress-list--heading-2 & {
    block-size: var(--ams-progress-list-heading-2-step-sub-steps-sub-step-marker-block-size);
  }

  .ams-progress-list--heading-3 & {
    block-size: var(--ams-progress-list-heading-3-step-sub-steps-sub-step-marker-block-size);
  }

  .ams-progress-list--heading-4 & {
    block-size: var(--ams-progress-list-heading-4-step-sub-steps-sub-step-marker-block-size);
  }

  // Style the connector when it belongs to the last sub-step of the last main step
  // .ams-progress-list > .ams-progress-list__step:last-child → last main step
  // .ams-progress-list__sub-steps → the sub-steps container within that step
  // .ams-progress-list__sub-step:last-child → the last sub-step in that container
  .ams-progress-list
    > .ams-progress-list__step:last-child
    .ams-progress-list__sub-steps
    .ams-progress-list__sub-step:last-child
    & {
    border-inline-color: var(--ams-progress-list-step-sub-steps-sub-step-connector-last-step-border-inline-color);
  }
}

// Content

.ams-progress-list__content {
  flex: auto;
  min-inline-size: 0;
}

// Body

.ams-progress-list__body {
  padding-block-start: var(--ams-progress-list-step-body-padding-block-start);

  .ams-progress-list__step:not(:last-child, .ams-progress-list__step--has-sub-steps) & {
    padding-block-end: var(--ams-progress-list-step-body-padding-block-end);
  }

  @supports selector(:has(*)) {
    .ams-progress-list__step:not(:last-child, :has(.ams-progress-list__sub-steps)) & {
      padding-block-end: var(--ams-progress-list-step-body-padding-block-end);
    }
  }
}

.ams-progress-list-sub-step__body {
  padding-inline-start: var(--ams-progress-list-step-sub-steps-sub-step-body-padding-inline-start);
}
