/**
 * @license EUPL-1.2+
 * Copyright Gemeente Amsterdam
 */

@use "../../common/breakpoint" as *;

@mixin reset-ol {
  list-style: none;
  margin-block: 0;
  padding-inline-start: 0;
}

@mixin marker {
  aspect-ratio: 1;
  border-radius: 50%;
  box-sizing: border-box;
  display: grid;
  place-content: center;
  z-index: 2;
}

@mixin connector {
  align-self: stretch;
  block-size: 100%;
  grid-area: 1 / 1;
  z-index: 1;
}

@mixin indicator {
  display: grid;
  flex: none;
  place-items: start center;
}

.ams-progress-list {
  @include reset-ol;
}

/* Step */

.ams-progress-list__step {
  display: flex;
  gap: var(--ams-progress-list-step-gap);

  @media screen and (min-width: $ams-breakpoint-medium) {
    gap: var(--ams-progress-list-step-medium-gap);
  }
}

/* Indicator: layout container for marker and connector */

.ams-progress-list__indicator {
  @include indicator;
}

/* Marker: layout container for shape */

.ams-progress-list__marker {
  display: flex;
  grid-area: 1 / 1; /* Overlaps marker and connector */
  place-items: center;

  .ams-progress-list--heading-2 & {
    block-size: var(--ams-progress-list-heading-2-step-marker-block-size);
  }

  .ams-progress-list--heading-3 & {
    block-size: var(--ams-progress-list-heading-3-step-marker-block-size);
  }

  .ams-progress-list--heading-4 & {
    block-size: var(--ams-progress-list-heading-4-step-marker-block-size);
  }
}

/* Shape: visual circle in marker */

.ams-progress-list__marker-shape {
  @include marker;

  background-color: var(--ams-progress-list-step-marker-shape-background-color);
  block-size: var(--ams-progress-list-step-marker-shape-block-size);
  border: var(--ams-progress-list-step-marker-shape-border-width)
    var(--ams-progress-list-step-marker-shape-border-style) var(--ams-progress-list-step-marker-shape-border-color);

  /* Outline adds space between shape and connector */
  outline: var(--ams-progress-list-step-marker-shape-outline-width)
    var(--ams-progress-list-step-marker-shape-outline-style) var(--ams-progress-list-step-marker-shape-outline-color);

  .ams-progress-list__step--completed & {
    background-color: var(--ams-progress-list-step-completed-marker-shape-background-color);
    border-color: var(--ams-progress-list-step-completed-marker-shape-border-color);
  }

  .ams-progress-list__step[aria-current] & {
    background-color: var(--ams-progress-list-step-current-marker-shape-background-color);
    border-color: var(--ams-progress-list-step-current-marker-shape-border-color);
  }
}

/* Connector */

.ams-progress-list__connector {
  @include connector;

  border-inline: var(--ams-progress-list-step-connector-border-inline-width)
    var(--ams-progress-list-step-connector-border-inline-style)
    var(--ams-progress-list-step-connector-border-inline-color);

  .ams-progress-list--heading-2 & {
    margin-block-start: var(--ams-progress-list-heading-2-step-marker-margin-block-start);
  }

  .ams-progress-list--heading-3 & {
    margin-block-start: var(--ams-progress-list-heading-3-step-marker-margin-block-start);
  }

  .ams-progress-list--heading-4 & {
    margin-block-start: var(--ams-progress-list-heading-4-step-marker-margin-block-start);
  }

  .ams-progress-list__step--completed & {
    background-color: var(--ams-progress-list-step-completed-connector-background-color);
    border-inline-color: var(--ams-progress-list-step-completed-connector-border-inline-color);
    border-inline-style: var(--ams-progress-list-step-completed-connector-border-inline-style);
  }

  .ams-progress-list__step--has-substeps & {
    border-inline-color: var(--ams-progress-list-step-current-connector-border-inline-color);
    border-inline-style: solid;
  }

  .ams-progress-list > :last-child:not(.ams-progress-list__step--has-substeps) & {
    display: none;
  }
}

/* Content */

.ams-progress-list__content {
  flex: auto;
  min-inline-size: 0; /* Ensure content can shrink to fit container */
}

/* Heading */

.ams-progress-list__heading {
  margin-block-end: var(--ams-progress-list-step-heading-margin-block-end);
}

/* Body */

.ams-progress-list__body {
  .ams-progress-list__step:not(:last-child, .ams-progress-list__step--has-substeps) & {
    margin-block-end: var(--ams-progress-list-step-body-margin-block-end);
  }
}

/* Substeps is its own block in BEM and has the same elements as above */

.ams-progress-list-substeps {
  @include reset-ol;

  * + & {
    /* Add white space if there is content preceding substeps */
    margin-block-start: var(--ams-progress-list-substeps-margin-block-start);
  }
}

.ams-progress-list-substeps__step {
  display: flex;
}

.ams-progress-list-substeps__indicator {
  @include indicator;

  margin-inline-end: var(--ams-progress-list-substeps-step-indicator-margin-inline-end);
  margin-inline-start: calc(
    -1 * var(--ams-progress-list-step-gap) - var(--ams-progress-list-step-marker-shape-block-size)
  );

  @media screen and (min-width: $ams-breakpoint-medium) {
    margin-inline-end: var(--ams-progress-list-substeps-step-indicator-medium-margin-inline-end);
    margin-inline-start: var(--ams-progress-list-substeps-step-indicator-medium-margin-inline-start);
  }
}

.ams-progress-list-substeps__marker {
  block-size: var(--ams-progress-list-substeps-step-marker-block-size);
  display: grid;
  grid-area: 1/1;
  inline-size: var(--ams-progress-list-substeps-step-marker-inline-size);
  place-items: center;
}

.ams-progress-list-substeps__marker-shape {
  @include marker;

  background-color: var(--ams-progress-list-substeps-step-marker-shape-background-color);
  block-size: var(--ams-progress-list-substeps-step-marker-shape-block-size);
  border: var(--ams-progress-list-substeps-step-marker-shape-border-width)
    var(--ams-progress-list-substeps-step-marker-shape-border-style)
    var(--ams-progress-list-substeps-step-marker-shape-border-color);

  /* Outline is used to create space between shape and connector */
  outline: var(--ams-progress-list-substeps-step-marker-shape-outline-width)
    var(--ams-progress-list-substeps-step-marker-shape-outline-style)
    var(--ams-progress-list-substeps-step-marker-shape-outline-color);

  .ams-progress-list-substeps__step--completed & {
    background-color: var(--ams-progress-list-substeps-step-completed-marker-shape-background-color);
    border-color: var(--ams-progress-list-substeps-step-completed-marker-shape-border-color);
  }

  .ams-progress-list-substeps__step[aria-current] & {
    background-color: var(--ams-progress-list-substeps-step-current-marker-shape-background-color);
    border-color: var(--ams-progress-list-substeps-step-current-marker-shape-border-color);
  }
}

.ams-progress-list-substeps__connector {
  @include connector;

  /* Cover underlying connector of parent step to prevent it from shining through. */
  background-color: var(--ams-progress-list-substeps-step-connector-background-color);
  border: var(--ams-progress-list-substeps-step-connector-border-inline-width)
    var(--ams-progress-list-substeps-step-connector-border-inline-style)
    var(--ams-progress-list-substeps-step-connector-border-inline-color);
  margin-block-start: var(--ams-progress-list-substeps-step-connector-margin-block-start);

  .ams-progress-list-substeps__step--completed & {
    background-color: var(--ams-progress-list-substeps-step-completed-connector-background-color);
    border-inline-color: var(--ams-progress-list-substeps-step-completed-connector-border-inline-color);
    border-inline-style: var(--ams-progress-list-substeps-step-completed-connector-border-inline-style);
  }

  /* Hide connector when it belongs to last substep of last main step */
  .ams-progress-list__step:last-child .ams-progress-list-substeps__step:last-child & {
    border-inline-color: var(--ams-progress-list-substeps-step-connector-last-child-border-inline-color);
  }
}

.ams-progress-list-substeps__body {
  margin-block-end: var(--ams-progress-list-substeps-step-body-margin-block-end);

  .ams-progress-list-substeps__step:last-of-type & {
    margin-block-end: var(--ams-progress-list-substeps-step-body-margin-block-end);
  }
}
