/**
 * @license EUPL-1.2+
 * Copyright Gemeente Amsterdam
 */

@use "../../common/breakpoint" as *;

@mixin reset-ol {
  list-style: none;
  margin-block: 0;
  padding-inline-start: 0;
}

@mixin marker {
  aspect-ratio: 1;
  border-radius: 50%;
  box-sizing: border-box;
  display: grid;
  place-content: center;
  z-index: 2;
}

@mixin connector {
  align-self: stretch;
  block-size: 100%;
  grid-area: 1 / 1;
  z-index: 1;
}

@mixin indicator {
  display: grid;
  flex: none;
  place-items: start center;
}

.ams-progress-list {
  @include reset-ol;
}

.ams-progress-list-substeps {
  @include reset-ol;

  * + & {
    // Add white space if there is content preceding the sub steps
    margin-block-start: var(--ams-progress-list-substeps-margin-block-start);
  }
}

// Step and substep

.ams-progress-list__step {
  display: flex;
  gap: var(--ams-progress-list-step-gap);

  @media screen and (min-width: $ams-breakpoint-medium) {
    gap: var(--ams-progress-list-step-medium-gap);
  }
}

.ams-progress-list-substeps__step {
  display: flex;
}

// Indicator: Layout container for the marker and connector.

.ams-progress-list__indicator {
  @include indicator;
}

.ams-progress-list-substeps__indicator {
  @include indicator;

  margin-inline-end: var(--ams-progress-list-substeps-step-indicator-margin-inline-end);
  margin-inline-start: calc(-1 * var(--ams-progress-list-step-gap) - var(--ams-progress-list-step-shape-block-size));

  @media screen and (min-width: $ams-breakpoint-medium) {
    margin-inline-end: var(--ams-progress-list-substeps-step-indicator-medium-margin-inline-end);
    margin-inline-start: var(--ams-progress-list-substeps-step-indicator-medium-margin-inline-start);
  }
}

// Marker: Layout container for the shape.

.ams-progress-list__marker {
  display: flex;
  grid-area: 1 / 1; // Overlaps the marker and connector.
  place-items: center;

  .ams-progress-list--heading-2 & {
    block-size: var(--ams-progress-list-heading-2-step-marker-block-size);
  }

  .ams-progress-list--heading-3 & {
    block-size: var(--ams-progress-list-heading-3-step-marker-block-size);
  }

  .ams-progress-list--heading-4 & {
    block-size: var(--ams-progress-list-heading-4-step-marker-block-size);
  }
}

// Shape: Visual circle inside marker.

.ams-progress-list__marker-shape {
  @include marker;

  background-color: var(--ams-progress-list-step-shape-background-color);
  block-size: var(--ams-progress-list-step-shape-block-size);
  border: var(--ams-progress-list-step-shape-border-width) var(--ams-progress-list-step-shape-border-style)
    var(--ams-progress-list-step-shape-border-color);

  // Outline is used to create space between the shape and the connector.
  outline: var(--ams-progress-list-step-shape-outline-width) var(--ams-progress-list-step-shape-outline-style)
    var(--ams-progress-list-step-shape-outline-color);

  .ams-progress-list__step--completed & {
    background-color: var(--ams-progress-list-step-completed-shape-background-color);
    border-color: var(--ams-progress-list-step-completed-shape-border-color);
  }

  .ams-progress-list__step[aria-current] & {
    background-color: var(--ams-progress-list-step-current-shape-background-color);
    border-color: var(--ams-progress-list-step-current-shape-border-color);
  }
}

// Substep Marker

.ams-progress-list-substeps__marker {
  block-size: var(--ams-progress-list-substeps-step-marker-block-size);
  display: grid;
  grid-area: 1/1;
  inline-size: var(--ams-progress-list-substeps-step-marker-inline-size);
  place-items: center;
}

.ams-progress-list-substeps__marker-shape {
  @include marker;

  background-color: var(--ams-progress-list-substeps-step-shape-background-color);
  block-size: var(--ams-progress-list-substeps-step-shape-block-size);
  border: var(--ams-progress-list-substeps-step-shape-border-width)
    var(--ams-progress-list-substeps-step-shape-border-style) var(--ams-progress-list-substeps-step-shape-border-color);

  // Outline is used to create space between the shape and the connector.
  outline: var(--ams-progress-list-substeps-step-shape-outline-width)
    var(--ams-progress-list-substeps-step-shape-outline-style)
    var(--ams-progress-list-substeps-step-shape-outline-color);

  .ams-progress-list-substeps__step--completed & {
    background-color: var(--ams-progress-list-substeps-step-completed-shape-background-color);
    border-color: var(--ams-progress-list-substeps-step-completed-shape-border-color);
  }

  .ams-progress-list-substeps__step[aria-current] & {
    background-color: var(--ams-progress-list-substeps-step-current-shape-background-color);
    border-color: var(--ams-progress-list-substeps-step-current-shape-border-color);
  }
}

// Connector

.ams-progress-list__connector {
  @include connector;

  border-inline: var(--ams-progress-list-step-connector-border-inline-width)
    var(--ams-progress-list-step-connector-border-inline-style)
    var(--ams-progress-list-step-connector-border-inline-color);

  .ams-progress-list--heading-2 & {
    margin-block-start: var(--ams-progress-list-heading-2-step-marker-margin-block-start);
  }

  .ams-progress-list--heading-3 & {
    margin-block-start: var(--ams-progress-list-heading-3-step-marker-margin-block-start);
  }

  .ams-progress-list--heading-4 & {
    margin-block-start: var(--ams-progress-list-heading-4-step-marker-margin-block-start);
  }

  .ams-progress-list__step--completed & {
    background-color: var(--ams-progress-list-step-completed-connector-background-color);
    border-inline-color: var(--ams-progress-list-step-completed-connector-border-inline-color);
    border-inline-style: var(--ams-progress-list-step-completed-connector-border-inline-style);
  }

  .ams-progress-list__step--has-substeps & {
    border-inline-color: var(--ams-progress-list-step-current-connector-border-inline-color);
    border-inline-style: solid;
  }

  .ams-progress-list > :last-child:not(.ams-progress-list__step--has-substeps) & {
    display: none;
  }
}

.ams-progress-list-substeps__connector {
  @include connector;

  /* Covers the underlying connector of the parent step to prevent it from shining through. */
  background-color: var(--ams-progress-list-substeps-step-connector-background-color);
  border: var(--ams-progress-list-substeps-step-connector-border-inline-width)
    var(--ams-progress-list-substeps-step-connector-border-inline-style)
    var(--ams-progress-list-substeps-step-connector-border-inline-color);
  margin-block-start: var(--ams-progress-list-substeps-step-connector-margin-block-start);

  .ams-progress-list-substeps__step--completed & {
    background-color: var(--ams-progress-list-substeps-step-completed-connector-background-color);
    border-inline-color: var(--ams-progress-list-substeps-step-completed-connector-border-inline-color);
    border-inline-style: var(--ams-progress-list-substeps-step-completed-connector-border-inline-style);
  }

  // Hide the connector when it belongs to the last substep of the last main step
  .ams-progress-list__step:last-child .ams-progress-list-substeps__step:last-child & {
    border-inline-color: var(--ams-progress-list-substeps-step-connector-last-child-border-inline-color);
  }
}

// Content

.ams-progress-list__content {
  flex: auto;
  min-inline-size: 0; /* Ensure content can shrink to fit the container */
}

// Heading

.ams-progress-list__heading {
  margin-block-end: var(--ams-progress-list-step-heading-margin-block-end);
}

// Body

.ams-progress-list__body {
  .ams-progress-list__step:not(:last-child, .ams-progress-list__step--has-substeps) & {
    margin-block-end: var(--ams-progress-list-step-body-margin-block-end);
  }
}

.ams-progress-list-substeps__body {
  margin-block-end: var(--ams-progress-list-substeps-step-body-margin-block-end);

  .ams-progress-list-substeps__step:last-of-type & {
    margin-block-end: var(--ams-progress-list-substeps-step-body-margin-block-end);
  }
}
